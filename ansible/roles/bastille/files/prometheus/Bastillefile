ARG ROLE_ID=52bc8fbe-7e78-b585-39a5-7d8ccc69696f

INCLUDE mjm/pkg
INCLUDE mjm/log
INCLUDE mjm/vault-agent --arg ROLE_ID=${ROLE_ID} --arg USER=root --arg GROUP=wheel
INCLUDE mjm/consul-template

# Use vault-agent to get a Vault token, then pass it off to consul-template
CP vault-agent.consul.hcl usr/local/etc/vault-agent.consul.hcl
CMD cat /usr/local/etc/vault-agent.base.hcl /usr/local/etc/vault-agent.consul.hcl > /usr/local/etc/vault-agent.hcl

CP prometheus.hcl usr/local/etc/consul-template.d/prometheus.hcl
CP prometheus.yml.tpl usr/local/etc/prometheus.yml.tpl

SERVICE vault-agent start
